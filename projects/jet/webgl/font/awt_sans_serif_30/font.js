/*
 * Written by David Lareau on April 10, 2011.
 * 
 * Font description (this is specific to one font in perticular, I know its dumb and info should be read from a data file)
 */
 
function AWTSansSerif_30_Font(gl) {

	// Attributes (hardcoded, generated from a tool)
	this.ascent = 31.0;
	this.descent = 7.0;
	this.interlineSpacing = 1.0;
	this.interCharacterSpacing = 0.0;
	this.monospaced = false;
	this.defaultChar = "a";
	this.prefixPath = "font/awt_sans_serif_30/";
	this.info = new Array();
	this.info["a"] = {width : 16, filename : "97.png"};
	this.info["b"] = {width : 17, filename : "98.png"};
	this.info["c"] = {width : 15, filename : "99.png"};
	this.info["d"] = {width : 17, filename : "100.png"};
	this.info["e"] = {width : 16, filename : "101.png"};
	this.info["f"] = {width : 8, filename : "102.png"};
	this.info["g"] = {width : 17, filename : "103.png"};
	this.info["h"] = {width : 17, filename : "104.png"};
	this.info["i"] = {width : 7, filename : "105.png"};
	this.info["j"] = {width : 7, filename : "106.png"};
	this.info["k"] = {width : 15, filename : "107.png"};
	this.info["l"] = {width : 7, filename : "108.png"};
	this.info["m"] = {width : 25, filename : "109.png"};
	this.info["n"] = {width : 17, filename : "110.png"};
	this.info["o"] = {width : 16, filename : "111.png"};
	this.info["p"] = {width : 17, filename : "112.png"};
	this.info["q"] = {width : 17, filename : "113.png"};
	this.info["r"] = {width : 10, filename : "114.png"};
	this.info["s"] = {width : 15, filename : "115.png"};
	this.info["t"] = {width : 8, filename : "116.png"};
	this.info["u"] = {width : 17, filename : "117.png"};
	this.info["v"] = {width : 15, filename : "118.png"};
	this.info["w"] = {width : 21, filename : "119.png"};
	this.info["x"] = {width : 14, filename : "120.png"};
	this.info["y"] = {width : 15, filename : "121.png"};
	this.info["z"] = {width : 15, filename : "122.png"};
	this.info["A"] = {width : 19, filename : "65.png"};
	this.info["B"] = {width : 20, filename : "66.png"};
	this.info["C"] = {width : 22, filename : "67.png"};
	this.info["D"] = {width : 22, filename : "68.png"};
	this.info["E"] = {width : 20, filename : "69.png"};
	this.info["F"] = {width : 18, filename : "70.png"};
	this.info["G"] = {width : 23, filename : "71.png"};
	this.info["H"] = {width : 22, filename : "72.png"};
	this.info["I"] = {width : 7, filename : "73.png"};
	this.info["J"] = {width : 15, filename : "74.png"};
	this.info["K"] = {width : 20, filename : "75.png"};
	this.info["L"] = {width : 17, filename : "76.png"};
	this.info["M"] = {width : 25, filename : "77.png"};
	this.info["N"] = {width : 22, filename : "78.png"};
	this.info["O"] = {width : 23, filename : "79.png"};
	this.info["P"] = {width : 20, filename : "80.png"};
	this.info["Q"] = {width : 23, filename : "81.png"};
	this.info["R"] = {width : 22, filename : "82.png"};
	this.info["S"] = {width : 20, filename : "83.png"};
	this.info["T"] = {width : 19, filename : "84.png"};
	this.info["U"] = {width : 22, filename : "85.png"};
	this.info["V"] = {width : 19, filename : "86.png"};
	this.info["W"] = {width : 30, filename : "87.png"};
	this.info["X"] = {width : 19, filename : "88.png"};
	this.info["Y"] = {width : 19, filename : "89.png"};
	this.info["Z"] = {width : 18, filename : "90.png"};
	this.info[" "] = {width : 8, filename : "32.png"};
	this.info["0"] = {width : 17, filename : "48.png"};
	this.info["1"] = {width : 17, filename : "49.png"};
	this.info["2"] = {width : 17, filename : "50.png"};
	this.info["3"] = {width : 17, filename : "51.png"};
	this.info["4"] = {width : 17, filename : "52.png"};
	this.info["5"] = {width : 17, filename : "53.png"};
	this.info["6"] = {width : 17, filename : "54.png"};
	this.info["7"] = {width : 17, filename : "55.png"};
	this.info["8"] = {width : 17, filename : "56.png"};
	this.info["9"] = {width : 17, filename : "57.png"};
	this.info["+"] = {width : 18, filename : "43.png"};
	this.info["-"] = {width : 10, filename : "45.png"};
	this.info["*"] = {width : 12, filename : "42.png"};
	this.info["/"] = {width : 8, filename : "47.png"};
	this.info["&"] = {width : 20, filename : "38.png"};
	this.info["%"] = {width : 27, filename : "37.png"};
	this.info["$"] = {width : 17, filename : "36.png"};
	this.info["#"] = {width : 17, filename : "35.png"};
	this.info["@"] = {width : 30, filename : "64.png"};
	this.info["!"] = {width : 9, filename : "33.png"};
	this.info["~"] = {width : 18, filename : "126.png"};
	this.info[":"] = {width : 8, filename : "58.png"};
	this.info[";"] = {width : 8, filename : "59.png"};
	this.info[">"] = {width : 18, filename : "62.png"};
	this.info["<"] = {width : 18, filename : "60.png"};
	this.info[","] = {width : 8, filename : "44.png"};
	this.info["."] = {width : 8, filename : "46.png"};
	this.info["?"] = {width : 17, filename : "63.png"};
	this.info["["] = {width : 8, filename : "91.png"};
	this.info["]"] = {width : 8, filename : "93.png"};
	this.info["{"] = {width : 10, filename : "123.png"};
	this.info["}"] = {width : 10, filename : "125.png"};
	this.info["\""] = {width : 11, filename : "34.png"};
	this.info["'"] = {width : 6, filename : "39.png"};
	this.info["="] = {width : 18, filename : "61.png"};
	this.info["_"] = {width : 17, filename : "95.png"};
	this.info[")"] = {width : 10, filename : "41.png"};
	this.info["("] = {width : 10, filename : "40.png"};
	this.info["`"] = {width : 10, filename : "96.png"};
	
	// Methods
	this.getHeight = function() {
		return this.ascent + this.descent;
	}

	this.getAscent = function() {
		return this.ascent;
	}

	this.getDescent = function() {
		return this.descent;
	}

	this.getInterLineSpacing = function() {
		return this.interlineSpacing;
	}

	this.getInterCharacterSpacing = function() {
		return this.interCharacterSpacing;
	}

	this.getWidth = function(c) {
		return this.info[c].width;
	}

	this.isMonospaced = function() {
		return this.monospaced;
	}

	this.drawChar = function(gl, c) {
		S.texturedModel(gl, this.info[c].vertex, this.info[c].texture, this.info[c].textureID);
		gl.drawArrays(gl.TRIANGLE_STRIP, 0, this.info[c].vertex.numItems);
		S.textureClear(gl);
	}

	// Print (this method is independant of the font, and use drawchar. It should technically be outside of this class but I've put it here during transcoding)
	this.print = function(gl, s, x, y, z, r, g, b) {
		S.color(gl, r, g, b, 0); // Note: my shader work with a fully transparent color mask
		S.modelView.push();
		S.modelView.translate(x, y, z);
		var n = s.length;
		for (var i = 0; i < n; i++) {
			var c = s.charAt(i);
			S.modelView.commit(gl);
			this.drawChar(gl, c);
			S.modelView.translate(this.getWidth(c) + this.getInterCharacterSpacing(), 0, 0);
		}
		S.modelView.pop();
	}


	// Create OpenGL Buffers for each letter
	for(var c in this.info) {
		var width = this.info[c].width;
		var w = greaterOrEqualPowerOfTwo(width);
		var height = this.getHeight();
		var h = greaterOrEqualPowerOfTwo(height);
		// Load image file
		this.info[c].textureID	= loadTexture(gl, this.prefixPath + this.info[c].filename);
		// Vertex Buffer
		var v = [
			0, -this.descent, 0,
			width, -this.descent, 0,
			0, this.ascent, 0,
			width, this.ascent, 0
		];		
		var vertex = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, vertex);
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(v), gl.STATIC_DRAW);
		vertex.itemSize = 3;
		vertex.numItems = 4;
		this.info[c].vertex = vertex;
		// Texture Buffer
		var left = 0;
		var right = width / w;
		var down = 1 - (height / h);
		var up = 1;
		var t = [
			left, down,
			right, down,
			left, up,
			right, up
		];
		var texture = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, texture);
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(t), gl.STATIC_DRAW);
		texture.itemSize = 2;
		texture.numItems = 4;
		this.info[c].texture = texture;
	}

}